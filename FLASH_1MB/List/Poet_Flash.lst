###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.60.1.5097/W32 for ARM      23/Jan/2015  01:58:38 #
# Copyright 1999-2013 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                    ShunAn_Panel\Poet_Flash.c                                #
#    Command line =  D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                    ShunAn_Panel\Poet_Flash.c -D IAR -D TWR_K60F120M -lCN    #
#                    D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                    FLASH_1MB\List\ -lB D:\创作室\飞思卡尔智能小车\顺暗三号\ #
#                    代码\MK60FX512VLQ15\FLASH_1MB\List\ -o                   #
#                    D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                    FLASH_1MB\Obj\ --no_cse --no_unroll --no_inline          #
#                    --no_code_motion --no_tbaa --no_clustering               #
#                    --no_scheduling --debug --endian=little --cpu=Cortex-M4  #
#                    -e --fpu=VFPv4_sp --dlib_config "C:\Program Files        #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.5\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                     -I D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VL #
#                    Q15\Library\ -I D:\创作室\飞思卡尔智能小车\顺暗三号\代码 #
#                    \MK60FX512VLQ15\Library\BlessedAlien\ -I                 #
#                    D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                    ShunAn_Panel\ -Ol --use_c++_inline                       #
#    List file    =  D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                    FLASH_1MB\List\Poet_Flash.lst                            #
#    Object file  =  D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ #
#                    FLASH_1MB\Obj\Poet_Flash.o                               #
#                                                                             #
#                                                                             #
###############################################################################

D:\创作室\飞思卡尔智能小车\顺暗三号\代码\MK60FX512VLQ15\ShunAn_Panel\Poet_Flash.c
      1          #include "MK60F15.h"
      2          #include "ShunAn_Lib.h"
      3          #include "start_ShunAn.h"
      4          #include "BlessedAlien.h"
      5          
      6          //#include "Poet_Scourage.h"
      7          #include "Poet_Flash.h"
      8          // Scourage
      9          // ========================================================================== //
     10          // W25Q64FV //
     11          /*
     12          // 时序计算
     13          读频率最大值 50MHz
     14          写频率最大值 104MHz
     15          CLK 单周期min     6ns
     16          CS下 => CLK上     5ns
     17          // /CS Deselect Time (for Erase or Program ? Read Status Registers) => 50ns
     18          CS到输出无效时间   7ns
     19          WP
     20          CS
     21          
     22          Flash操作
     23          CLK Low To Data Output => 7ns // 下降沿数据扇出
     24          // 上升沿读取数据
     25          
     26          相应=> K70应保证上升沿扇出数据，下降沿读取数据
     27          */
     28          // 默认八位结构
     29          // ========================================================================== //
     30          // 
     31          //#define v_DSPI_SetFrameSize(FrameSize)          do{Flash_SPI_PTR->CTAR[0] |= SPI_CTAR_FMSZ(FrameSize-1);}while(0)  
     32          //#define v_DSPI_HaltTx()                         do{Flash_SPI_PTR->MCR |= SPI_MCR_HALT_MASK;}while(0)
     33          //#define v_DSPI_GoonTx()                         do{Flash_SPI_PTR->MCR &=~SPI_MCR_HALT_MASK;}while(0)
     34          
     35          

   \                                 In section .text, align 2, keep-with-next
     36          uint8 b_DSPI_Init()
     37          {
     38              // ====================================================================== //
     39              /* 引脚配置 */
     40              SIM_SCGC6 |= SIM_SCGC6_DSPI1_MASK; //
   \                     b_DSPI_Init: (+1)
   \   00000000   0x.... 0x....      LDR.W    R0,??DataTable6  ;; 0x4004803c
   \   00000004   0x6800             LDR      R0,[R0, #+0]
   \   00000006   0xF450 0x5000      ORRS     R0,R0,#0x2000
   \   0000000A   0x.... 0x....      LDR.W    R1,??DataTable6  ;; 0x4004803c
   \   0000000E   0x6008             STR      R0,[R1, #+0]
     41              SIM_SCGC5 |= SIM_SCGC5_PORTE_MASK;
   \   00000010   0x.... 0x....      LDR.W    R0,??DataTable6_1  ;; 0x40048038
   \   00000014   0x6800             LDR      R0,[R0, #+0]
   \   00000016   0xF450 0x5000      ORRS     R0,R0,#0x2000
   \   0000001A   0x.... 0x....      LDR.W    R1,??DataTable6_1  ;; 0x40048038
   \   0000001E   0x6008             STR      R0,[R1, #+0]
     42              PORTE_BASE_PTR->PCR[0] = 0x00000200u; // CS1
   \   00000020   0x.... 0x....      LDR.W    R0,??DataTable6_2  ;; 0x4004d000
   \   00000024   0xF44F 0x7100      MOV      R1,#+512
   \   00000028   0x6001             STR      R1,[R0, #+0]
     43              PORTE_BASE_PTR->PCR[1] = 0x00000200u; // OUT
   \   0000002A   0x.... 0x....      LDR.W    R0,??DataTable6_3  ;; 0x4004d004
   \   0000002E   0xF44F 0x7100      MOV      R1,#+512
   \   00000032   0x6001             STR      R1,[R0, #+0]
     44              PORTE_BASE_PTR->PCR[2] = 0x00000200u; // CLK
   \   00000034   0x.... 0x....      LDR.W    R0,??DataTable6_4  ;; 0x4004d008
   \   00000038   0xF44F 0x7100      MOV      R1,#+512
   \   0000003C   0x6001             STR      R1,[R0, #+0]
     45              PORTE_BASE_PTR->PCR[3] = 0x00000200u; // IN
   \   0000003E   0x.... 0x....      LDR.W    R0,??DataTable6_5  ;; 0x4004d00c
   \   00000042   0xF44F 0x7100      MOV      R1,#+512
   \   00000046   0x6001             STR      R1,[R0, #+0]
     46              
     47              // ====================================================================== //
     48              /* 停止传输 */
     49              Flash_SPI_PTR->MCR |= SPI_MCR_HALT_MASK; // 停止传输
   \   00000048   0x.... 0x....      LDR.W    R0,??DataTable6_6  ;; 0x4002d000
   \   0000004C   0x6800             LDR      R0,[R0, #+0]
   \   0000004E   0xF050 0x0001      ORRS     R0,R0,#0x1
   \   00000052   0x.... 0x....      LDR.W    R1,??DataTable6_6  ;; 0x4002d000
   \   00000056   0x6008             STR      R0,[R1, #+0]
     50              /* 清除信息 */
     51              Flash_SPI_PTR->MCR |= SPI_MCR_CLR_RXF_MASK | SPI_MCR_CLR_TXF_MASK; // 清空FIFO
   \   00000058   0x.... 0x....      LDR.W    R0,??DataTable6_6  ;; 0x4002d000
   \   0000005C   0x6800             LDR      R0,[R0, #+0]
   \   0000005E   0xF450 0x6040      ORRS     R0,R0,#0xC00
   \   00000062   0x.... 0x....      LDR.W    R1,??DataTable6_6  ;; 0x4002d000
   \   00000066   0x6008             STR      R0,[R1, #+0]
     52              Flash_SPI_PTR->SR  = SPI_SR_EOQF_MASK 
     53                                 | SPI_SR_TFUF_MASK 
     54                                 | SPI_SR_TFFF_MASK
     55                                 | SPI_SR_RFOF_MASK 
     56                                 | SPI_SR_RFDF_MASK
     57                                // | SPI_SR_TXRXS_MASK
     58                                // | SPI_SR_TCF_MASK        // 清空发送
     59                                 ; 
   \   00000068   0x.... 0x....      LDR.W    R0,??DataTable6_7  ;; 0x4002d02c
   \   0000006C   0x.... 0x....      LDR.W    R1,??DataTable6_8  ;; 0x1a0a0000
   \   00000070   0x6001             STR      R1,[R0, #+0]
     60              /* 配置基础信息 */
     61              Flash_SPI_PTR->MCR =  SPI_MCR_MSTR_MASK
     62                                  | SPI_MCR_CONT_SCKE_MASK
     63                                  | SPI_MCR_PCSIS_MASK
     64                                  | SPI_MCR_PCSSE_MASK
     65                                 //==================//
     66                                  | SPI_MCR_ROOE_MASK
     67                                  | SPI_MCR_MTFE_MASK
     68                                 // | SPI_MCR_PCSIS_MASK
     69                                 // | SPI_MCR_DIS_TXF_MASK  // 关闭FIFO
     70                                 // | SPI_MCR_DIS_RXF_MASK  // 关闭FIFO
     71                                 // | SPI_MCR_SMPL_PT(2)    // one system clock 
     72                                  ;
   \   00000072   0x.... 0x....      LDR.W    R0,??DataTable6_6  ;; 0x4002d000
   \   00000076   0x.... 0x....      LDR.W    R1,??DataTable6_9  ;; 0xc73f0000
   \   0000007A   0x6001             STR      R1,[R0, #+0]
     73                                   //主机//接收清空//传输清空//片选位置
     74              // ====================================================================== //
     75              // 时间分频 // 输入Bus Clock => 最大值限制为75MHz （数据未更改）
     76              Flash_SPI_PTR->CTAR[0] = SPI_CTAR_FMSZ(7)           // 八位模式
     77                                     // =============================================== //
     78                                     | SPI_CTAR_PBR(3)//1
     79                                     | SPI_CTAR_BR(2)//0//1
     80                                    // | SPI_CTAR_DBR_MASK //
     81                                     // =============================================== //
     82                                     // 应最小保证 5ns
     83                                     | SPI_CTAR_PCSSCK(1)         // PCS to SCK Delay Prescaler
     84                                     | SPI_CTAR_CSSCK(0)          // PCS to SCK Delay Scaler
     85                                     // =============================================== //
     86                                     // 应最小保证 5ns
     87                                     | SPI_CTAR_PASC(1)
     88                                     | SPI_CTAR_ASC(0)
     89                                     // =============================================== //
     90                                     // 应最小保证 50ns
     91                                     | SPI_CTAR_PDT(1)
     92                                     | SPI_CTAR_DT(4)  
     93                                     // =============================================== // 
     94                                     | SPI_CTAR_CPHA_MASK 
     95                                     | SPI_CTAR_CPOL_MASK
     96                                     | SPI_CTAR_DBR_MASK
     97                                     ;
   \   0000007C   0x.... 0x....      LDR.W    R0,??DataTable6_10  ;; 0x4002d00c
   \   00000080   0x.... 0x....      LDR.W    R1,??DataTable6_11  ;; 0xbe570042
   \   00000084   0x6001             STR      R1,[R0, #+0]
     98              Flash_SPI_PTR->CTAR[1] = SPI_CTAR_FMSZ(15)           // 十六位模式
     99                                     // =============================================== //
    100                                     | SPI_CTAR_PBR(3)//1
    101                                     | SPI_CTAR_BR(2)//0//1
    102                                    // | SPI_CTAR_DBR_MASK //
    103                                     // =============================================== //
    104                                     // 应最小保证 5ns
    105                                     | SPI_CTAR_PCSSCK(1)         // PCS to SCK Delay Prescaler
    106                                     | SPI_CTAR_CSSCK(0)          // PCS to SCK Delay Scaler
    107                                     // =============================================== //
    108                                     // 应最小保证 5ns
    109                                     | SPI_CTAR_PASC(1)
    110                                     | SPI_CTAR_ASC(0)
    111                                     // =============================================== //
    112                                     // 应最小保证 50ns
    113                                     | SPI_CTAR_PDT(1)
    114                                     | SPI_CTAR_DT(4)  
    115                                     // =============================================== // 
    116                                     | SPI_CTAR_CPHA_MASK 
    117                                     | SPI_CTAR_CPOL_MASK
    118                                     | SPI_CTAR_DBR_MASK
    119                                     ;
   \   00000086   0x.... 0x....      LDR.W    R0,??DataTable6_12  ;; 0x4002d010
   \   0000008A   0x.... 0x....      LDR.W    R1,??DataTable6_13  ;; 0xfe570042
   \   0000008E   0x6001             STR      R1,[R0, #+0]
    120              // ====================================================================== //
    121              Flash_SPI_PTR->MCR &=~SPI_MCR_HALT_MASK; // 使能传输
   \   00000090   0x.... 0x....      LDR.W    R0,??DataTable6_6  ;; 0x4002d000
   \   00000094   0x6800             LDR      R0,[R0, #+0]
   \   00000096   0x0840             LSRS     R0,R0,#+1
   \   00000098   0x0040             LSLS     R0,R0,#+1
   \   0000009A   0x.... 0x....      LDR.W    R1,??DataTable6_6  ;; 0x4002d000
   \   0000009E   0x6008             STR      R0,[R1, #+0]
    122              return 'T';
   \   000000A0   0x2054             MOVS     R0,#+84
   \   000000A2   0x4770             BX       LR               ;; return
    123          }
    124          
    125          
    126          // ========================================================================== //
    127          // 

   \                                 In section .text, align 2, keep-with-next
    128          void v_DSPI_PushTx(uint16 pushNum,uint8 isClkCoun,uint8 isClrCounter,uint8 isEndQueue,uint8 CTARn)
    129          {
   \                     v_DSPI_PushTx: (+1)
   \   00000000   0xB410             PUSH     {R4}
    130              // ====================================================================== //
    131              // 数据入栈
    132              Flash_SPI_PTR->PUSHR = ( 0
    133                                           | SPI_PUSHR_CTAS(CTARn)                 //选择CTAR0寄存器
    134                                           | SPI_PUSHR_PCS(1 << 1)
    135                                           | (isClrCounter << SPI_PUSHR_CTCNT_SHIFT )
    136                                           | (isClkCoun << SPI_PUSHR_CONT_SHIFT)                //1为 传输SPI最后的数据
    137                                           | SPI_PUSHR_TXDATA( pushNum )
    138                                           | (isEndQueue << SPI_PUSHR_EOQ_SHIFT)
    139                                           );
   \   00000002   0x9C01             LDR      R4,[SP, #+4]
   \   00000004   0x0724             LSLS     R4,R4,#+28
   \   00000006   0xF014 0x44E0      ANDS     R4,R4,#0x70000000
   \   0000000A   0xB2D2             UXTB     R2,R2            ;; ZeroExt  R2,R2,#+24,#+24
   \   0000000C   0xEA54 0x6282      ORRS     R2,R4,R2, LSL #+26
   \   00000010   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   00000012   0xEA52 0x71C1      ORRS     R1,R2,R1, LSL #+31
   \   00000016   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000018   0x4308             ORRS     R0,R0,R1
   \   0000001A   0xB2DB             UXTB     R3,R3            ;; ZeroExt  R3,R3,#+24,#+24
   \   0000001C   0xEA50 0x60C3      ORRS     R0,R0,R3, LSL #+27
   \   00000020   0xF450 0x3000      ORRS     R0,R0,#0x20000
   \   00000024   0x.... 0x....      LDR.W    R1,??DataTable6_14  ;; 0x4002d034
   \   00000028   0x6008             STR      R0,[R1, #+0]
    140          }
   \   0000002A   0xBC10             POP      {R4}
   \   0000002C   0x4770             BX       LR               ;; return
    141          
    142          
    143          // ========================================================================== //
    144          // 

   \                                 In section .text, align 2, keep-with-next
    145          uint8 b_DSPI_PoP(void * popArray,uint8 popArrayCounter,uint8 * popCounter,uint8 CTARn)
    146          {
   \                     b_DSPI_PoP: (+1)
   \   00000000   0xB470             PUSH     {R4-R6}
    147              // 接收问题 //
    148              uint16 time = 60000;
   \   00000002   0xF64E 0x2460      MOVW     R4,#+60000
    149              while(Flash_SPI_PTR->SR & SPI_SR_TXRXS_MASK)
   \                     ??b_DSPI_PoP_0: (+1)
   \   00000006   0x.... 0x....      LDR.W    R5,??DataTable6_7  ;; 0x4002d02c
   \   0000000A   0x682D             LDR      R5,[R5, #+0]
   \   0000000C   0x006D             LSLS     R5,R5,#+1
   \   0000000E   0xD506             BPL.N    ??b_DSPI_PoP_1
    150              {
    151                  if(!(time--)){return 'F';}
   \   00000010   0x0025             MOVS     R5,R4
   \   00000012   0x1E6C             SUBS     R4,R5,#+1
   \   00000014   0xB2AD             UXTH     R5,R5            ;; ZeroExt  R5,R5,#+16,#+16
   \   00000016   0x2D00             CMP      R5,#+0
   \   00000018   0xD1F5             BNE.N    ??b_DSPI_PoP_0
   \   0000001A   0x2046             MOVS     R0,#+70
   \   0000001C   0xE036             B.N      ??b_DSPI_PoP_2
    152              }
    153              uint8 readCounter = 0;//读取计数
   \                     ??b_DSPI_PoP_1: (+1)
   \   0000001E   0x2500             MOVS     R5,#+0
    154              readCounter = Flash_SPI_PTR->SR;
   \   00000020   0x.... 0x....      LDR.W    R4,??DataTable6_7  ;; 0x4002d02c
   \   00000024   0x6824             LDR      R4,[R4, #+0]
   \   00000026   0x0025             MOVS     R5,R4
    155              readCounter = (readCounter & SPI_SR_RXCTR_MASK) >> SPI_SR_RXCTR_SHIFT;
   \   00000028   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000002A   0x092D             LSRS     R5,R5,#+4
    156              if(readCounter > popArrayCounter){return 'F';}//限幅
   \   0000002C   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   0000002E   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   00000030   0x42A9             CMP      R1,R5
   \   00000032   0xD201             BCS.N    ??b_DSPI_PoP_3
   \   00000034   0x2046             MOVS     R0,#+70
   \   00000036   0xE029             B.N      ??b_DSPI_PoP_2
    157              //popArrayCounter--;//因为数组修剪popArrayCounter
    158              time = 0;//为了接受进行修剪
   \                     ??b_DSPI_PoP_3: (+1)
   \   00000038   0x2400             MOVS     R4,#+0
    159              popArrayCounter = 0;//常系数修剪
   \   0000003A   0x2100             MOVS     R1,#+0
    160              do
    161              {
    162                  time++;
   \                     ??b_DSPI_PoP_4: (+1)
   \   0000003C   0x1C64             ADDS     R4,R4,#+1
    163                  if(CTARn)
   \   0000003E   0xB2DB             UXTB     R3,R3            ;; ZeroExt  R3,R3,#+24,#+24
   \   00000040   0x2B00             CMP      R3,#+0
   \   00000042   0xD006             BEQ.N    ??b_DSPI_PoP_5
    164                  {//1
    165                      ((uint16*)(popArray))[popArrayCounter] = Flash_SPI_PTR->POPR;
   \   00000044   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   00000046   0x.... 0x....      LDR.W    R5,??DataTable6_15  ;; 0x4002d038
   \   0000004A   0x682D             LDR      R5,[R5, #+0]
   \   0000004C   0xF820 0x5011      STRH     R5,[R0, R1, LSL #+1]
   \   00000050   0xE004             B.N      ??b_DSPI_PoP_6
    166                  }
    167                  else
    168                  {//0 
    169                      ((uint8*)(popArray))[popArrayCounter] = Flash_SPI_PTR->POPR;
   \                     ??b_DSPI_PoP_5: (+1)
   \   00000052   0xB2C9             UXTB     R1,R1            ;; ZeroExt  R1,R1,#+24,#+24
   \   00000054   0x.... 0x....      LDR.W    R5,??DataTable6_15  ;; 0x4002d038
   \   00000058   0x682D             LDR      R5,[R5, #+0]
   \   0000005A   0x540D             STRB     R5,[R1, R0]
    170                  }
    171                  popArrayCounter++;
   \                     ??b_DSPI_PoP_6: (+1)
   \   0000005C   0x1C49             ADDS     R1,R1,#+1
    172                  readCounter = ((Flash_SPI_PTR->SR & SPI_SR_RXCTR_MASK) >> SPI_SR_RXCTR_SHIFT);
   \   0000005E   0x.... 0x....      LDR.W    R5,??DataTable6_7  ;; 0x4002d02c
   \   00000062   0x682D             LDR      R5,[R5, #+0]
   \   00000064   0xF3C5 0x1503      UBFX     R5,R5,#+4,#+4
    173                  if(0 == readCounter){Flash_SPI_PTR->SR |= SPI_SR_RFDF_MASK;}
   \   00000068   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000006A   0x2D00             CMP      R5,#+0
   \   0000006C   0xD107             BNE.N    ??b_DSPI_PoP_7
   \   0000006E   0x.... 0x....      LDR.W    R5,??DataTable6_7  ;; 0x4002d02c
   \   00000072   0x682D             LDR      R5,[R5, #+0]
   \   00000074   0xF455 0x3500      ORRS     R5,R5,#0x20000
   \   00000078   0x.... 0x....      LDR.W    R6,??DataTable6_7  ;; 0x4002d02c
   \   0000007C   0x6035             STR      R5,[R6, #+0]
    174              }
    175              while(Flash_SPI_PTR->SR & SPI_SR_RFDF_MASK);
   \                     ??b_DSPI_PoP_7: (+1)
   \   0000007E   0x.... 0x....      LDR.W    R5,??DataTable6_7  ;; 0x4002d02c
   \   00000082   0x682D             LDR      R5,[R5, #+0]
   \   00000084   0x03AD             LSLS     R5,R5,#+14
   \   00000086   0xD4D9             BMI.N    ??b_DSPI_PoP_4
    176              (*popCounter) = time;//返回弹出个数
   \   00000088   0x7014             STRB     R4,[R2, #+0]
    177              return 'T';
   \   0000008A   0x2054             MOVS     R0,#+84
   \                     ??b_DSPI_PoP_2: (+1)
   \   0000008C   0xBC70             POP      {R4-R6}
   \   0000008E   0x4770             BX       LR               ;; return
    178          }
    179          
    180          

   \                                 In section .text, align 2, keep-with-next
    181          uint8 b_DSPI_ClrRx()
    182          {
    183              uint16 time = 60000;
   \                     b_DSPI_ClrRx: (+1)
   \   00000000   0xF64E 0x2060      MOVW     R0,#+60000
    184              while(Flash_SPI_PTR->SR & SPI_SR_TXRXS_MASK)
   \                     ??b_DSPI_ClrRx_0: (+1)
   \   00000004   0x.... 0x....      LDR.W    R1,??DataTable6_7  ;; 0x4002d02c
   \   00000008   0x6809             LDR      R1,[R1, #+0]
   \   0000000A   0x0049             LSLS     R1,R1,#+1
   \   0000000C   0xD506             BPL.N    ??b_DSPI_ClrRx_1
    185              {
    186                  if(!(time--)){return 'F';}
   \   0000000E   0x0001             MOVS     R1,R0
   \   00000010   0x1E48             SUBS     R0,R1,#+1
   \   00000012   0xB289             UXTH     R1,R1            ;; ZeroExt  R1,R1,#+16,#+16
   \   00000014   0x2900             CMP      R1,#+0
   \   00000016   0xD1F5             BNE.N    ??b_DSPI_ClrRx_0
   \   00000018   0x2046             MOVS     R0,#+70
   \   0000001A   0xE010             B.N      ??b_DSPI_ClrRx_2
    187              }
    188              Flash_SPI_PTR->SR |= SPI_SR_RFDF_MASK;
   \                     ??b_DSPI_ClrRx_1: (+1)
   \   0000001C   0x.... 0x....      LDR.W    R0,??DataTable6_7  ;; 0x4002d02c
   \   00000020   0x6800             LDR      R0,[R0, #+0]
   \   00000022   0xF450 0x3000      ORRS     R0,R0,#0x20000
   \   00000026   0x.... 0x....      LDR.W    R1,??DataTable6_7  ;; 0x4002d02c
   \   0000002A   0x6008             STR      R0,[R1, #+0]
    189              Flash_SPI_PTR->MCR |= (SPI_MCR_CLR_RXF_MASK);
   \   0000002C   0x.... 0x....      LDR.W    R0,??DataTable6_6  ;; 0x4002d000
   \   00000030   0x6800             LDR      R0,[R0, #+0]
   \   00000032   0xF450 0x6080      ORRS     R0,R0,#0x400
   \   00000036   0x.... 0x....      LDR.W    R1,??DataTable6_6  ;; 0x4002d000
   \   0000003A   0x6008             STR      R0,[R1, #+0]
    190              return 'T';
   \   0000003C   0x2054             MOVS     R0,#+84
   \                     ??b_DSPI_ClrRx_2: (+1)
   \   0000003E   0x4770             BX       LR               ;; return
    191          }
    192          // ========================================================================== //
    193          // Flash初始化
    194          // 写使能

   \                                 In section .data, align 4
    195          uint16 g_Tx[] = {0xFF,0xFF,0xFe,0xFe};
   \                     g_Tx:
   \   00000000   0x00FF 0x00FF      DC16 255, 255, 254, 254
   \              0x00FE 0x00FE

   \                                 In section .bss, align 1
    196          uint8 g_RxCounter = 0;
   \                     g_RxCounter:
   \   00000000                      DS8 1

   \                                 In section .text, align 2, keep-with-next
    197          uint8 b_Flash_Init()
    198          {
   \                     b_Flash_Init: (+1)
   \   00000000   0xB510             PUSH     {R4,LR}
   \   00000002   0xB086             SUB      SP,SP,#+24
    199              if('F' == b_DSPI_Init()){return 'F';}
   \   00000004   0x.... 0x....      BL       b_DSPI_Init
   \   00000008   0x2846             CMP      R0,#+70
   \   0000000A   0xD101             BNE.N    ??b_Flash_Init_0
   \   0000000C   0x2046             MOVS     R0,#+70
   \   0000000E   0xE135             B.N      ??b_Flash_Init_1
    200              // ==================== //
    201              //uint8 error_occur = 0;//错误计数
    202              do /* 确认芯片型号 */
    203              {
    204                  //break; 
    205                  //v_DSPI_SetFrameSize(8);
    206                  uint8 Tx[] = {0x9F,0xFF,0xFF,0xFF};
   \                     ??b_Flash_Init_0: (+1)
   \   00000010   0xA802             ADD      R0,SP,#+8
   \   00000012   0x.... 0x....      LDR.W    R1,??DataTable6_16
   \   00000016   0x680A             LDR      R2,[R1, #0]
   \   00000018   0x6002             STR      R2,[R0, #+0]
    207                  uint8 RxCounter = 0;
   \   0000001A   0x2000             MOVS     R0,#+0
   \   0000001C   0xF88D 0x0005      STRB     R0,[SP, #+5]
    208                  v_DSPI_PushTx(Tx[0],1,1,0,CATR0);
   \   00000020   0x2000             MOVS     R0,#+0
   \   00000022   0x9000             STR      R0,[SP, #+0]
   \   00000024   0x2300             MOVS     R3,#+0
   \   00000026   0x2201             MOVS     R2,#+1
   \   00000028   0x2101             MOVS     R1,#+1
   \   0000002A   0xF89D 0x0008      LDRB     R0,[SP, #+8]
   \   0000002E   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000030   0x.... 0x....      BL       v_DSPI_PushTx
    209                  v_DSPI_PushTx(Tx[1],1,0,0,CATR0);
   \   00000034   0x2000             MOVS     R0,#+0
   \   00000036   0x9000             STR      R0,[SP, #+0]
   \   00000038   0x2300             MOVS     R3,#+0
   \   0000003A   0x2200             MOVS     R2,#+0
   \   0000003C   0x2101             MOVS     R1,#+1
   \   0000003E   0xF89D 0x0009      LDRB     R0,[SP, #+9]
   \   00000042   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000044   0x.... 0x....      BL       v_DSPI_PushTx
    210                  v_DSPI_PushTx(Tx[2],1,0,0,CATR0);
   \   00000048   0x2000             MOVS     R0,#+0
   \   0000004A   0x9000             STR      R0,[SP, #+0]
   \   0000004C   0x2300             MOVS     R3,#+0
   \   0000004E   0x2200             MOVS     R2,#+0
   \   00000050   0x2101             MOVS     R1,#+1
   \   00000052   0xF89D 0x000A      LDRB     R0,[SP, #+10]
   \   00000056   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000058   0x.... 0x....      BL       v_DSPI_PushTx
    211                  v_DSPI_PushTx(Tx[3],0,0,1,CATR0);//传送开始
   \   0000005C   0x2000             MOVS     R0,#+0
   \   0000005E   0x9000             STR      R0,[SP, #+0]
   \   00000060   0x2301             MOVS     R3,#+1
   \   00000062   0x2200             MOVS     R2,#+0
   \   00000064   0x2100             MOVS     R1,#+0
   \   00000066   0xF89D 0x000B      LDRB     R0,[SP, #+11]
   \   0000006A   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   0000006C   0x.... 0x....      BL       v_DSPI_PushTx
    212                  if('F' == b_DSPI_PopRx(Tx,&RxCounter,Rec_u8)){return 'F';}
   \   00000070   0x2300             MOVS     R3,#+0
   \   00000072   0xF10D 0x0205      ADD      R2,SP,#+5
   \   00000076   0x2104             MOVS     R1,#+4
   \   00000078   0xA802             ADD      R0,SP,#+8
   \   0000007A   0x.... 0x....      BL       b_DSPI_PoP
   \   0000007E   0x2846             CMP      R0,#+70
   \   00000080   0xD101             BNE.N    ??b_Flash_Init_2
   \   00000082   0x2046             MOVS     R0,#+70
   \   00000084   0xE0FA             B.N      ??b_Flash_Init_1
    213                  if( (sizeof(Tx)/sizeof(Tx[0])) != RxCounter){/*error_occur = 1;*/return 'F';}
   \                     ??b_Flash_Init_2: (+1)
   \   00000086   0xF89D 0x0005      LDRB     R0,[SP, #+5]
   \   0000008A   0x2804             CMP      R0,#+4
   \   0000008C   0xD001             BEQ.N    ??b_Flash_Init_3
   \   0000008E   0x2046             MOVS     R0,#+70
   \   00000090   0xE0F4             B.N      ??b_Flash_Init_1
    214                  if(0xEF != Tx[1]){return 'F';}
   \                     ??b_Flash_Init_3: (+1)
   \   00000092   0xF89D 0x0009      LDRB     R0,[SP, #+9]
   \   00000096   0x28EF             CMP      R0,#+239
   \   00000098   0xD001             BEQ.N    ??b_Flash_Init_4
   \   0000009A   0x2046             MOVS     R0,#+70
   \   0000009C   0xE0EE             B.N      ??b_Flash_Init_1
    215                  if(0x40 != Tx[2]){return 'F';}
   \                     ??b_Flash_Init_4: (+1)
   \   0000009E   0xF89D 0x000A      LDRB     R0,[SP, #+10]
   \   000000A2   0x2840             CMP      R0,#+64
   \   000000A4   0xD001             BEQ.N    ??b_Flash_Init_5
   \   000000A6   0x2046             MOVS     R0,#+70
   \   000000A8   0xE0E8             B.N      ??b_Flash_Init_1
    216                  if(0x17 != Tx[3]){return 'F';}
   \                     ??b_Flash_Init_5: (+1)
   \   000000AA   0xF89D 0x000B      LDRB     R0,[SP, #+11]
   \   000000AE   0x2817             CMP      R0,#+23
   \   000000B0   0xD001             BEQ.N    ??b_Flash_Init_6
   \   000000B2   0x2046             MOVS     R0,#+70
   \   000000B4   0xE0E2             B.N      ??b_Flash_Init_1
    217              }
    218              while(0);
    219              do // == 状态位控制 == //
    220              {
    221                  //break;
    222                  v_DSPI_PushTx(0x06,0,1,1,CATR0); // 写寄存器使能
   \                     ??b_Flash_Init_6: (+1)
   \   000000B6   0x2000             MOVS     R0,#+0
   \   000000B8   0x9000             STR      R0,[SP, #+0]
   \   000000BA   0x2301             MOVS     R3,#+1
   \   000000BC   0x2201             MOVS     R2,#+1
   \   000000BE   0x2100             MOVS     R1,#+0
   \   000000C0   0x2006             MOVS     R0,#+6
   \   000000C2   0x.... 0x....      BL       v_DSPI_PushTx
    223                  uint8 Tx[] = {0xFF,0xFF};
   \   000000C6   0x....             LDR.N    R0,??DataTable6_17
   \   000000C8   0x8800             LDRH     R0,[R0, #+0]
   \   000000CA   0xF8AD 0x0006      STRH     R0,[SP, #+6]
    224                  uint8 RxCounter = 0;
   \   000000CE   0x2000             MOVS     R0,#+0
   \   000000D0   0xF88D 0x0004      STRB     R0,[SP, #+4]
    225                  if('F' == b_DSPI_ClrRx()){return 'F';}
   \   000000D4   0x.... 0x....      BL       b_DSPI_ClrRx
   \   000000D8   0x2846             CMP      R0,#+70
   \   000000DA   0xD101             BNE.N    ??b_Flash_Init_7
   \   000000DC   0x2046             MOVS     R0,#+70
   \   000000DE   0xE0CD             B.N      ??b_Flash_Init_1
    226                  // 寄存器 1
    227                  v_DSPI_PushTx(0x35,1,1,0,CATR0); // 读寄存器
   \                     ??b_Flash_Init_7: (+1)
   \   000000E0   0x2000             MOVS     R0,#+0
   \   000000E2   0x9000             STR      R0,[SP, #+0]
   \   000000E4   0x2300             MOVS     R3,#+0
   \   000000E6   0x2201             MOVS     R2,#+1
   \   000000E8   0x2101             MOVS     R1,#+1
   \   000000EA   0x2035             MOVS     R0,#+53
   \   000000EC   0x.... 0x....      BL       v_DSPI_PushTx
    228                  v_DSPI_PushTx(0xFF,0,0,1,CATR0);
   \   000000F0   0x2000             MOVS     R0,#+0
   \   000000F2   0x9000             STR      R0,[SP, #+0]
   \   000000F4   0x2301             MOVS     R3,#+1
   \   000000F6   0x2200             MOVS     R2,#+0
   \   000000F8   0x2100             MOVS     R1,#+0
   \   000000FA   0x20FF             MOVS     R0,#+255
   \   000000FC   0x.... 0x....      BL       v_DSPI_PushTx
    229                  if('F' == b_DSPI_PopRx(Tx,&RxCounter,Rec_u8)){return 'F';}
   \   00000100   0x2300             MOVS     R3,#+0
   \   00000102   0xAA01             ADD      R2,SP,#+4
   \   00000104   0x2102             MOVS     R1,#+2
   \   00000106   0xF10D 0x0006      ADD      R0,SP,#+6
   \   0000010A   0x.... 0x....      BL       b_DSPI_PoP
   \   0000010E   0x2846             CMP      R0,#+70
   \   00000110   0xD101             BNE.N    ??b_Flash_Init_8
   \   00000112   0x2046             MOVS     R0,#+70
   \   00000114   0xE0B2             B.N      ??b_Flash_Init_1
    230                  if(2 != RxCounter){return 'F';}
   \                     ??b_Flash_Init_8: (+1)
   \   00000116   0xF89D 0x0004      LDRB     R0,[SP, #+4]
   \   0000011A   0x2802             CMP      R0,#+2
   \   0000011C   0xD001             BEQ.N    ??b_Flash_Init_9
   \   0000011E   0x2046             MOVS     R0,#+70
   \   00000120   0xE0AC             B.N      ??b_Flash_Init_1
    231                  if(Tx[1]){return 'F';}
   \                     ??b_Flash_Init_9: (+1)
   \   00000122   0xF89D 0x0007      LDRB     R0,[SP, #+7]
   \   00000126   0x2800             CMP      R0,#+0
   \   00000128   0xD001             BEQ.N    ??b_Flash_Init_10
   \   0000012A   0x2046             MOVS     R0,#+70
   \   0000012C   0xE0A6             B.N      ??b_Flash_Init_1
    232                  // 寄存器 2
    233                  v_DSPI_PushTx(0x05,1,1,0,CATR0); // 读寄存器
   \                     ??b_Flash_Init_10: (+1)
   \   0000012E   0x2000             MOVS     R0,#+0
   \   00000130   0x9000             STR      R0,[SP, #+0]
   \   00000132   0x2300             MOVS     R3,#+0
   \   00000134   0x2201             MOVS     R2,#+1
   \   00000136   0x2101             MOVS     R1,#+1
   \   00000138   0x2005             MOVS     R0,#+5
   \   0000013A   0x.... 0x....      BL       v_DSPI_PushTx
    234                  v_DSPI_PushTx(0xFF,0,0,1,CATR0);
   \   0000013E   0x2000             MOVS     R0,#+0
   \   00000140   0x9000             STR      R0,[SP, #+0]
   \   00000142   0x2301             MOVS     R3,#+1
   \   00000144   0x2200             MOVS     R2,#+0
   \   00000146   0x2100             MOVS     R1,#+0
   \   00000148   0x20FF             MOVS     R0,#+255
   \   0000014A   0x.... 0x....      BL       v_DSPI_PushTx
    235                  if('F' == b_DSPI_PopRx(Tx,&RxCounter,Rec_u8)){return 'F';}
   \   0000014E   0x2300             MOVS     R3,#+0
   \   00000150   0xAA01             ADD      R2,SP,#+4
   \   00000152   0x2102             MOVS     R1,#+2
   \   00000154   0xF10D 0x0006      ADD      R0,SP,#+6
   \   00000158   0x.... 0x....      BL       b_DSPI_PoP
   \   0000015C   0x2846             CMP      R0,#+70
   \   0000015E   0xD101             BNE.N    ??b_Flash_Init_11
   \   00000160   0x2046             MOVS     R0,#+70
   \   00000162   0xE08B             B.N      ??b_Flash_Init_1
    236                  if(2 != RxCounter){return 'F';}
   \                     ??b_Flash_Init_11: (+1)
   \   00000164   0xF89D 0x0004      LDRB     R0,[SP, #+4]
   \   00000168   0x2802             CMP      R0,#+2
   \   0000016A   0xD001             BEQ.N    ??b_Flash_Init_12
   \   0000016C   0x2046             MOVS     R0,#+70
   \   0000016E   0xE085             B.N      ??b_Flash_Init_1
    237                  if(!(Tx[1] & 0x02)){return 'F';}
   \                     ??b_Flash_Init_12: (+1)
   \   00000170   0xF89D 0x0007      LDRB     R0,[SP, #+7]
   \   00000174   0x0780             LSLS     R0,R0,#+30
   \   00000176   0xD401             BMI.N    ??b_Flash_Init_13
   \   00000178   0x2046             MOVS     R0,#+70
   \   0000017A   0xE07F             B.N      ??b_Flash_Init_1
    238                  v_DSPI_PushTx(0x04,0,1,1,CATR0); // 写寄存器无效
   \                     ??b_Flash_Init_13: (+1)
   \   0000017C   0x2000             MOVS     R0,#+0
   \   0000017E   0x9000             STR      R0,[SP, #+0]
   \   00000180   0x2301             MOVS     R3,#+1
   \   00000182   0x2201             MOVS     R2,#+1
   \   00000184   0x2100             MOVS     R1,#+0
   \   00000186   0x2004             MOVS     R0,#+4
   \   00000188   0x.... 0x....      BL       v_DSPI_PushTx
    239                  if('F' == b_DSPI_ClrRx()){return 'F';}
   \   0000018C   0x.... 0x....      BL       b_DSPI_ClrRx
   \   00000190   0x2846             CMP      R0,#+70
   \   00000192   0xD101             BNE.N    ??b_Flash_Init_14
   \   00000194   0x2046             MOVS     R0,#+70
   \   00000196   0xE071             B.N      ??b_Flash_Init_1
    240              }
    241              while(0);
    242              do /* 测试采集程序 */
    243              {
    244                  //break;
    245                  uint16 Tx[] = {0xFF,0xFF,0xFF,0xFF};
   \                     ??b_Flash_Init_14: (+1)
   \   00000198   0xA803             ADD      R0,SP,#+12
   \   0000019A   0x....             LDR.N    R1,??DataTable6_18
   \   0000019C   0xC90C             LDM      R1!,{R2,R3}
   \   0000019E   0xC00C             STM      R0!,{R2,R3}
   \   000001A0   0x3908             SUBS     R1,R1,#+8
   \   000001A2   0x3808             SUBS     R0,R0,#+8
    246                  uint8 RxCounter = 0;
   \   000001A4   0x2400             MOVS     R4,#+0
    247                 // if('F' == b_Flash_EnsureWillWrite()){return 'F';} // 确认清除
    248                 // v_DSPI_PushTx(0x4400,1,1,0,CATR1);
    249                 // v_DSPI_PushTx(0x3000,0,0,1,CATR1);
    250                 // if('F' == b_DSPI_ClrRx()){return 'F';}
    251                 // if('F' == b_Flash_EnsureRest()){return 'F';} // 确认空闲
    252                 // if('F' == b_Flash_EnsureWillWrite()){return 'F';} // 确认清除
    253                  if('F' == b_Flash_EnsureWillWrite()){return 'F';} // 确认清除
   \   000001A6   0x.... 0x....      BL       b_Flash_EnsureWillWrite
   \   000001AA   0x2846             CMP      R0,#+70
   \   000001AC   0xD101             BNE.N    ??b_Flash_Init_15
   \   000001AE   0x2046             MOVS     R0,#+70
   \   000001B0   0xE064             B.N      ??b_Flash_Init_1
    254                  v_DSPI_PushTx(0x4200,1,1,0,CATR1);
   \                     ??b_Flash_Init_15: (+1)
   \   000001B2   0x2001             MOVS     R0,#+1
   \   000001B4   0x9000             STR      R0,[SP, #+0]
   \   000001B6   0x2300             MOVS     R3,#+0
   \   000001B8   0x2201             MOVS     R2,#+1
   \   000001BA   0x2101             MOVS     R1,#+1
   \   000001BC   0xF44F 0x4084      MOV      R0,#+16896
   \   000001C0   0x.... 0x....      BL       v_DSPI_PushTx
    255                  v_DSPI_PushTx(0x3001,1,0,0,CATR1);
   \   000001C4   0x2001             MOVS     R0,#+1
   \   000001C6   0x9000             STR      R0,[SP, #+0]
   \   000001C8   0x2300             MOVS     R3,#+0
   \   000001CA   0x2200             MOVS     R2,#+0
   \   000001CC   0x2101             MOVS     R1,#+1
   \   000001CE   0xF243 0x0001      MOVW     R0,#+12289
   \   000001D2   0x.... 0x....      BL       v_DSPI_PushTx
    256                  v_DSPI_PushTx(0xF006,1,0,0,CATR1);
   \   000001D6   0x2001             MOVS     R0,#+1
   \   000001D8   0x9000             STR      R0,[SP, #+0]
   \   000001DA   0x2300             MOVS     R3,#+0
   \   000001DC   0x2200             MOVS     R2,#+0
   \   000001DE   0x2101             MOVS     R1,#+1
   \   000001E0   0xF24F 0x0006      MOVW     R0,#+61446
   \   000001E4   0x.... 0x....      BL       v_DSPI_PushTx
    257                  v_DSPI_PushTx(0xF007,0,0,1,CATR1);
   \   000001E8   0x2001             MOVS     R0,#+1
   \   000001EA   0x9000             STR      R0,[SP, #+0]
   \   000001EC   0x2301             MOVS     R3,#+1
   \   000001EE   0x2200             MOVS     R2,#+0
   \   000001F0   0x2100             MOVS     R1,#+0
   \   000001F2   0xF24F 0x0007      MOVW     R0,#+61447
   \   000001F6   0x.... 0x....      BL       v_DSPI_PushTx
    258                  if('F' == b_DSPI_ClrRx()){return 'F';}
   \   000001FA   0x.... 0x....      BL       b_DSPI_ClrRx
   \   000001FE   0x2846             CMP      R0,#+70
   \   00000200   0xD101             BNE.N    ??b_Flash_Init_16
   \   00000202   0x2046             MOVS     R0,#+70
   \   00000204   0xE03A             B.N      ??b_Flash_Init_1
    259                  if('F' == b_Flash_EnsureRest()){return 'F';} // 确认空闲
   \                     ??b_Flash_Init_16: (+1)
   \   00000206   0x.... 0x....      BL       b_Flash_EnsureRest
   \   0000020A   0x2846             CMP      R0,#+70
   \   0000020C   0xD101             BNE.N    ??b_Flash_Init_17
   \   0000020E   0x2046             MOVS     R0,#+70
   \   00000210   0xE034             B.N      ??b_Flash_Init_1
    260                  if('F' == b_Flash_EnsureWillWrite()){return 'F';} // 确认清除
   \                     ??b_Flash_Init_17: (+1)
   \   00000212   0x.... 0x....      BL       b_Flash_EnsureWillWrite
   \   00000216   0x2846             CMP      R0,#+70
   \   00000218   0xD101             BNE.N    ??b_Flash_Init_18
   \   0000021A   0x2046             MOVS     R0,#+70
   \   0000021C   0xE02E             B.N      ??b_Flash_Init_1
    261                  
    262                  v_DSPI_PushTx(0x4800,1,1,0,CATR1);
   \                     ??b_Flash_Init_18: (+1)
   \   0000021E   0x2001             MOVS     R0,#+1
   \   00000220   0x9000             STR      R0,[SP, #+0]
   \   00000222   0x2300             MOVS     R3,#+0
   \   00000224   0x2201             MOVS     R2,#+1
   \   00000226   0x2101             MOVS     R1,#+1
   \   00000228   0xF44F 0x4090      MOV      R0,#+18432
   \   0000022C   0x.... 0x....      BL       v_DSPI_PushTx
    263                  v_DSPI_PushTx(0x3000,1,0,0,CATR1);
   \   00000230   0x2001             MOVS     R0,#+1
   \   00000232   0x9000             STR      R0,[SP, #+0]
   \   00000234   0x2300             MOVS     R3,#+0
   \   00000236   0x2200             MOVS     R2,#+0
   \   00000238   0x2101             MOVS     R1,#+1
   \   0000023A   0xF44F 0x5040      MOV      R0,#+12288
   \   0000023E   0x.... 0x....      BL       v_DSPI_PushTx
    264                  v_DSPI_PushTx(0xF006,1,0,0,CATR1);
   \   00000242   0x2001             MOVS     R0,#+1
   \   00000244   0x9000             STR      R0,[SP, #+0]
   \   00000246   0x2300             MOVS     R3,#+0
   \   00000248   0x2200             MOVS     R2,#+0
   \   0000024A   0x2101             MOVS     R1,#+1
   \   0000024C   0xF24F 0x0006      MOVW     R0,#+61446
   \   00000250   0x.... 0x....      BL       v_DSPI_PushTx
    265                  v_DSPI_PushTx(0xF007,0,0,1,CATR1);
   \   00000254   0x2001             MOVS     R0,#+1
   \   00000256   0x9000             STR      R0,[SP, #+0]
   \   00000258   0x2301             MOVS     R3,#+1
   \   0000025A   0x2200             MOVS     R2,#+0
   \   0000025C   0x2100             MOVS     R1,#+0
   \   0000025E   0xF24F 0x0007      MOVW     R0,#+61447
   \   00000262   0x.... 0x....      BL       v_DSPI_PushTx
    266                  if('F' == b_DSPI_PopRx(g_Tx,&g_RxCounter,Rec_u16)){return 'F';}
   \   00000266   0x2301             MOVS     R3,#+1
   \   00000268   0x....             LDR.N    R2,??DataTable6_19
   \   0000026A   0x2104             MOVS     R1,#+4
   \   0000026C   0x....             LDR.N    R0,??DataTable6_20
   \   0000026E   0x.... 0x....      BL       b_DSPI_PoP
   \   00000272   0x2846             CMP      R0,#+70
   \   00000274   0xD101             BNE.N    ??b_Flash_Init_19
   \   00000276   0x2046             MOVS     R0,#+70
   \   00000278   0xE000             B.N      ??b_Flash_Init_1
    267                  
    268                 // if('F' == b_Flash_EnsureRest()){return 'F';} // 确认空闲
    269                 // if('F' == b_Flash_EnsureWillWrite()){return 'F';} // 确认清除
    270                  
    271                  //v_DSPI_SetFrameSize(8);
    272              }
    273              while(0);
    274              //if('F' == b_Flash_Write(0,0,0)){return 'F';}
    275              return 'T';
   \                     ??b_Flash_Init_19: (+1)
   \   0000027A   0x2054             MOVS     R0,#+84
   \                     ??b_Flash_Init_1: (+1)
   \   0000027C   0xB006             ADD      SP,SP,#+24
   \   0000027E   0xBD10             POP      {R4,PC}          ;; return
    276          }
    277          
    278          /*
    279          Status Bits
    280          15      suspend status
    281          14      complement protect
    282          13      security register lock bits
    283          12      
    284          11      
    285          10      
    286          9       quad enable
    287          8       status regisrer protect 1
    288          7       status register protect 0
    289          6       sector protect
    290          5       top/bottom protect
    291          4       block protect bits
    292          3
    293          2
    294          1       write enable latch
    295          0       erase or write in progress
    296          */
    297          
    298          // ========================================================================== //
    299          // 地址输入：000000h C 7F FFFF h
    300          // 1 Block => 64K // 128 Blocks => 8M
    301          // 25MHz => 40ns*8*2080 => 665600ns => 665.6 us => 0.6656 ms => 256 bytes
    302          // ========================================================================== //
    303          // 确认将要可以读取
    304          // 功能代码

   \                                 In section .text, align 2, keep-with-next
    305          uint8 b_Flash_EnsureWillWrite()
    306          {
   \                     b_Flash_EnsureWillWrite: (+1)
   \   00000000   0xB530             PUSH     {R4,R5,LR}
   \   00000002   0xB083             SUB      SP,SP,#+12
    307              uint16 time = 60000;
   \   00000004   0xF64E 0x2460      MOVW     R4,#+60000
    308              uint8 Tx[] = {0,0xFF};
   \   00000008   0x....             LDR.N    R0,??DataTable6_21
   \   0000000A   0x8800             LDRH     R0,[R0, #+0]
   \   0000000C   0xF8AD 0x0006      STRH     R0,[SP, #+6]
    309              uint8 RxCounter = 0;
   \   00000010   0x2000             MOVS     R0,#+0
   \   00000012   0xF88D 0x0004      STRB     R0,[SP, #+4]
    310              uint8 Bit_Much = (Flash_SPI_PTR->CTAR[0] & SPI_CTAR_FMSZ_MASK)>>SPI_CTAR_FMSZ_SHIFT;
   \   00000016   0x....             LDR.N    R0,??DataTable6_10  ;; 0x4002d00c
   \   00000018   0x6800             LDR      R0,[R0, #+0]
   \   0000001A   0x0EC0             LSRS     R0,R0,#+27
   \   0000001C   0xF010 0x050F      ANDS     R5,R0,#0xF
    311              do
    312              {
    313                  
    314                  v_DSPI_PushTx(0x06,0,1,1,CTAR0); // 写寄存器使能
   \                     ??b_Flash_EnsureWillWrite_0: (+1)
   \   00000020   0x2000             MOVS     R0,#+0
   \   00000022   0x9000             STR      R0,[SP, #+0]
   \   00000024   0x2301             MOVS     R3,#+1
   \   00000026   0x2201             MOVS     R2,#+1
   \   00000028   0x2100             MOVS     R1,#+0
   \   0000002A   0x2006             MOVS     R0,#+6
   \   0000002C   0x.... 0x....      BL       v_DSPI_PushTx
    315                  if('F' == b_DSPI_ClrRx()){return 'F';}
   \   00000030   0x.... 0x....      BL       b_DSPI_ClrRx
   \   00000034   0x2846             CMP      R0,#+70
   \   00000036   0xD101             BNE.N    ??b_Flash_EnsureWillWrite_1
   \   00000038   0x2046             MOVS     R0,#+70
   \   0000003A   0xE02F             B.N      ??b_Flash_EnsureWillWrite_2
    316                  v_DSPI_PushTx(0x05,1,1,0,CTAR0); // 
   \                     ??b_Flash_EnsureWillWrite_1: (+1)
   \   0000003C   0x2000             MOVS     R0,#+0
   \   0000003E   0x9000             STR      R0,[SP, #+0]
   \   00000040   0x2300             MOVS     R3,#+0
   \   00000042   0x2201             MOVS     R2,#+1
   \   00000044   0x2101             MOVS     R1,#+1
   \   00000046   0x2005             MOVS     R0,#+5
   \   00000048   0x.... 0x....      BL       v_DSPI_PushTx
    317                  v_DSPI_PushTx(0xFF,0,0,1,CTAR0); // 
   \   0000004C   0x2000             MOVS     R0,#+0
   \   0000004E   0x9000             STR      R0,[SP, #+0]
   \   00000050   0x2301             MOVS     R3,#+1
   \   00000052   0x2200             MOVS     R2,#+0
   \   00000054   0x2100             MOVS     R1,#+0
   \   00000056   0x20FF             MOVS     R0,#+255
   \   00000058   0x.... 0x....      BL       v_DSPI_PushTx
    318                  if('F' == b_DSPI_PopRx(Tx,&RxCounter,Rec_u8)){return 'F';}
   \   0000005C   0x2300             MOVS     R3,#+0
   \   0000005E   0xAA01             ADD      R2,SP,#+4
   \   00000060   0x2102             MOVS     R1,#+2
   \   00000062   0xF10D 0x0006      ADD      R0,SP,#+6
   \   00000066   0x.... 0x....      BL       b_DSPI_PoP
   \   0000006A   0x2846             CMP      R0,#+70
   \   0000006C   0xD101             BNE.N    ??b_Flash_EnsureWillWrite_3
   \   0000006E   0x2046             MOVS     R0,#+70
   \   00000070   0xE014             B.N      ??b_Flash_EnsureWillWrite_2
    319                  if(!(time--)){return 'F';}
   \                     ??b_Flash_EnsureWillWrite_3: (+1)
   \   00000072   0x0020             MOVS     R0,R4
   \   00000074   0x1E44             SUBS     R4,R0,#+1
   \   00000076   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000078   0x2800             CMP      R0,#+0
   \   0000007A   0xD101             BNE.N    ??b_Flash_EnsureWillWrite_4
   \   0000007C   0x2046             MOVS     R0,#+70
   \   0000007E   0xE00D             B.N      ??b_Flash_EnsureWillWrite_2
    320               }
    321               while(!(Tx[1] & 0x02)); // 1则可以退出
   \                     ??b_Flash_EnsureWillWrite_4: (+1)
   \   00000080   0xF89D 0x0007      LDRB     R0,[SP, #+7]
   \   00000084   0x0780             LSLS     R0,R0,#+30
   \   00000086   0xD5CB             BPL.N    ??b_Flash_EnsureWillWrite_0
    322               Flash_SPI_PTR->CTAR[0] |= SPI_CTAR_FMSZ(Bit_Much);
   \   00000088   0x....             LDR.N    R0,??DataTable6_10  ;; 0x4002d00c
   \   0000008A   0x6800             LDR      R0,[R0, #+0]
   \   0000008C   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000008E   0x06E9             LSLS     R1,R5,#+27
   \   00000090   0xF011 0x41F0      ANDS     R1,R1,#0x78000000
   \   00000094   0x4308             ORRS     R0,R1,R0
   \   00000096   0x....             LDR.N    R1,??DataTable6_10  ;; 0x4002d00c
   \   00000098   0x6008             STR      R0,[R1, #+0]
    323               return 'T';
   \   0000009A   0x2054             MOVS     R0,#+84
   \                     ??b_Flash_EnsureWillWrite_2: (+1)
   \   0000009C   0xBD3E             POP      {R1-R5,PC}       ;; return
    324          }
    325          
    326          
    327          // ========================================================================== //
    328          //
    329          // 功能代码

   \                                 In section .text, align 2, keep-with-next
    330          uint8 b_Flash_EnsureRest()
    331          {    
   \                     b_Flash_EnsureRest: (+1)
   \   00000000   0xB530             PUSH     {R4,R5,LR}
   \   00000002   0xB083             SUB      SP,SP,#+12
    332              uint16 time = 60000;
   \   00000004   0xF64E 0x2460      MOVW     R4,#+60000
    333              uint8 Tx[] = {0,0};            
   \   00000008   0x2000             MOVS     R0,#+0
   \   0000000A   0xF8AD 0x0006      STRH     R0,[SP, #+6]
    334              uint8 RxCounter = 0;
   \   0000000E   0x2000             MOVS     R0,#+0
   \   00000010   0xF88D 0x0004      STRB     R0,[SP, #+4]
    335              Flash_SPI_PTR->MCR |= (SPI_MCR_CLR_TXF_MASK);
   \   00000014   0x....             LDR.N    R0,??DataTable6_6  ;; 0x4002d000
   \   00000016   0x6800             LDR      R0,[R0, #+0]
   \   00000018   0xF450 0x6000      ORRS     R0,R0,#0x800
   \   0000001C   0x....             LDR.N    R1,??DataTable6_6  ;; 0x4002d000
   \   0000001E   0x6008             STR      R0,[R1, #+0]
    336              uint8 Bit_Much = (Flash_SPI_PTR->CTAR[0] & SPI_CTAR_FMSZ_MASK)>>SPI_CTAR_FMSZ_SHIFT;
   \   00000020   0x....             LDR.N    R0,??DataTable6_10  ;; 0x4002d00c
   \   00000022   0x6800             LDR      R0,[R0, #+0]
   \   00000024   0x0EC0             LSRS     R0,R0,#+27
   \   00000026   0xF010 0x050F      ANDS     R5,R0,#0xF
    337              do
    338              {
    339                  //v_DSPI_SetFrameSize(8);
    340                  v_DSPI_PushTx(0x05,1,1,0,CTAR0); // 
   \                     ??b_Flash_EnsureRest_0: (+1)
   \   0000002A   0x2000             MOVS     R0,#+0
   \   0000002C   0x9000             STR      R0,[SP, #+0]
   \   0000002E   0x2300             MOVS     R3,#+0
   \   00000030   0x2201             MOVS     R2,#+1
   \   00000032   0x2101             MOVS     R1,#+1
   \   00000034   0x2005             MOVS     R0,#+5
   \   00000036   0x.... 0x....      BL       v_DSPI_PushTx
    341                  v_DSPI_PushTx(0xFF,0,0,1,CTAR0); // 
   \   0000003A   0x2000             MOVS     R0,#+0
   \   0000003C   0x9000             STR      R0,[SP, #+0]
   \   0000003E   0x2301             MOVS     R3,#+1
   \   00000040   0x2200             MOVS     R2,#+0
   \   00000042   0x2100             MOVS     R1,#+0
   \   00000044   0x20FF             MOVS     R0,#+255
   \   00000046   0x.... 0x....      BL       v_DSPI_PushTx
    342                  if('F' == b_DSPI_PopRx(Tx,&RxCounter,Rec_u8)){return 'F';}
   \   0000004A   0x2300             MOVS     R3,#+0
   \   0000004C   0xAA01             ADD      R2,SP,#+4
   \   0000004E   0x2102             MOVS     R1,#+2
   \   00000050   0xF10D 0x0006      ADD      R0,SP,#+6
   \   00000054   0x.... 0x....      BL       b_DSPI_PoP
   \   00000058   0x2846             CMP      R0,#+70
   \   0000005A   0xD101             BNE.N    ??b_Flash_EnsureRest_1
   \   0000005C   0x2046             MOVS     R0,#+70
   \   0000005E   0xE014             B.N      ??b_Flash_EnsureRest_2
    343                  if(!(time--)){return 'F';}
   \                     ??b_Flash_EnsureRest_1: (+1)
   \   00000060   0x0020             MOVS     R0,R4
   \   00000062   0x1E44             SUBS     R4,R0,#+1
   \   00000064   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000066   0x2800             CMP      R0,#+0
   \   00000068   0xD101             BNE.N    ??b_Flash_EnsureRest_3
   \   0000006A   0x2046             MOVS     R0,#+70
   \   0000006C   0xE00D             B.N      ??b_Flash_EnsureRest_2
    344              }
    345              while(Tx[1] & 0x01);//当不忙时跳出循环
   \                     ??b_Flash_EnsureRest_3: (+1)
   \   0000006E   0xF89D 0x0007      LDRB     R0,[SP, #+7]
   \   00000072   0x07C0             LSLS     R0,R0,#+31
   \   00000074   0xD4D9             BMI.N    ??b_Flash_EnsureRest_0
    346              Flash_SPI_PTR->CTAR[0] |= SPI_CTAR_FMSZ(Bit_Much);
   \   00000076   0x....             LDR.N    R0,??DataTable6_10  ;; 0x4002d00c
   \   00000078   0x6800             LDR      R0,[R0, #+0]
   \   0000007A   0xB2ED             UXTB     R5,R5            ;; ZeroExt  R5,R5,#+24,#+24
   \   0000007C   0x06E9             LSLS     R1,R5,#+27
   \   0000007E   0xF011 0x41F0      ANDS     R1,R1,#0x78000000
   \   00000082   0x4308             ORRS     R0,R1,R0
   \   00000084   0x....             LDR.N    R1,??DataTable6_10  ;; 0x4002d00c
   \   00000086   0x6008             STR      R0,[R1, #+0]
    347              return 'T';
   \   00000088   0x2054             MOVS     R0,#+84
   \                     ??b_Flash_EnsureRest_2: (+1)
   \   0000008A   0xBD3E             POP      {R1-R5,PC}       ;; return
    348          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6:
   \   00000000   0x4004803C         DC32     0x4004803c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_1:
   \   00000000   0x40048038         DC32     0x40048038

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_2:
   \   00000000   0x4004D000         DC32     0x4004d000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_3:
   \   00000000   0x4004D004         DC32     0x4004d004

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_4:
   \   00000000   0x4004D008         DC32     0x4004d008

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_5:
   \   00000000   0x4004D00C         DC32     0x4004d00c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_6:
   \   00000000   0x4002D000         DC32     0x4002d000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_7:
   \   00000000   0x4002D02C         DC32     0x4002d02c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_8:
   \   00000000   0x1A0A0000         DC32     0x1a0a0000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_9:
   \   00000000   0xC73F0000         DC32     0xc73f0000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_10:
   \   00000000   0x4002D00C         DC32     0x4002d00c

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_11:
   \   00000000   0xBE570042         DC32     0xbe570042

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_12:
   \   00000000   0x4002D010         DC32     0x4002d010

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_13:
   \   00000000   0xFE570042         DC32     0xfe570042

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_14:
   \   00000000   0x4002D034         DC32     0x4002d034

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_15:
   \   00000000   0x4002D038         DC32     0x4002d038

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_16:
   \   00000000   0x........         DC32     `?<Constant {159, 255, 255, 255}>`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_17:
   \   00000000   0x........         DC32     `?<Constant {255, 255}>`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_18:
   \   00000000   0x........         DC32     `?<Constant {255, 255, 255, 255}>`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_19:
   \   00000000   0x........         DC32     g_RxCounter

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_20:
   \   00000000   0x........         DC32     g_Tx

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable6_21:
   \   00000000   0x........         DC32     `?<Constant {0, 255}>`

   \                                 In section .rodata, align 4
   \                     `?<Constant {159, 255, 255, 255}>`:
   \   00000000   0x9F 0xFF          DC8 159, 255, 255, 255
   \              0xFF 0xFF    

   \                                 In section .rodata, align 2
   \                     `?<Constant {255, 255}>`:
   \   00000000   0xFF 0xFF          DC8 255, 255

   \                                 In section .rodata, align 4
   \                     `?<Constant {255, 255, 255, 255}>`:
   \   00000000   0x00FF 0x00FF      DC16 255, 255, 255, 255
   \              0x00FF 0x00FF

   \                                 In section .rodata, align 2
   \                     `?<Constant {0, 255}>`:
   \   00000000   0x00 0xFF          DC8 0, 255

   \                                 In section .rodata, align 2
   \   00000000   0x00 0x00          DC8 0, 0

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   b_DSPI_ClrRx
       0   b_DSPI_Init
      12   b_DSPI_PoP
      24   b_Flash_EnsureRest
        24   -> b_DSPI_PoP
        24   -> v_DSPI_PushTx
      24   b_Flash_EnsureWillWrite
        24   -> b_DSPI_ClrRx
        24   -> b_DSPI_PoP
        24   -> v_DSPI_PushTx
      32   b_Flash_Init
        32   -> b_DSPI_ClrRx
        32   -> b_DSPI_Init
        32   -> b_DSPI_PoP
        32   -> b_Flash_EnsureRest
        32   -> b_Flash_EnsureWillWrite
        32   -> v_DSPI_PushTx
       4   v_DSPI_PushTx


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       2  ?<Constant {0, 0}>
       2  ?<Constant {0, 255}>
       4  ?<Constant {159, 255, 255, 255}>
       8  ?<Constant {255, 255, 255, 255}>
       2  ?<Constant {255, 255}>
       4  ??DataTable6
       4  ??DataTable6_1
       4  ??DataTable6_10
       4  ??DataTable6_11
       4  ??DataTable6_12
       4  ??DataTable6_13
       4  ??DataTable6_14
       4  ??DataTable6_15
       4  ??DataTable6_16
       4  ??DataTable6_17
       4  ??DataTable6_18
       4  ??DataTable6_19
       4  ??DataTable6_2
       4  ??DataTable6_20
       4  ??DataTable6_21
       4  ??DataTable6_3
       4  ??DataTable6_4
       4  ??DataTable6_5
       4  ??DataTable6_6
       4  ??DataTable6_7
       4  ??DataTable6_8
       4  ??DataTable6_9
      64  b_DSPI_ClrRx
     164  b_DSPI_Init
     144  b_DSPI_PoP
     140  b_Flash_EnsureRest
     158  b_Flash_EnsureWillWrite
     640  b_Flash_Init
       1  g_RxCounter
       8  g_Tx
      46  v_DSPI_PushTx

 
     1 byte  in section .bss
     8 bytes in section .data
    18 bytes in section .rodata
 1 444 bytes in section .text
 
 1 444 bytes of CODE  memory
    18 bytes of CONST memory
     9 bytes of DATA  memory

Errors: none
Warnings: 2
